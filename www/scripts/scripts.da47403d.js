"use strict";function AuthentificationService(a,b,c,d){function e(){var a=d.get(l);a&&f(a)}function f(a){h(a),i()}function g(a){d.set(l,a),h(a),i()}function h(a){m=!0,k=a,b.defaults.headers.common.Authorization=k,n.showBar=!0}function i(){n.showBar=!0,n.menu.sidemenu=[{icon:"dashboard",label:"Dashboard",state:"dashboard"}],setView(n),initController()}function j(){k=void 0,m=!1,b.defaults.headers.common.Authorization=void 0,n.showBar=!1,d.remove(l)}var k,l="tokenKey",m=!1,n={showBar:!1,menu:{}},o=function(a){return c(function(c,d){b.post(API_ENDPOINT.url+"/signup",a).then(function(a){a.data.success?c(a.data.msg):d(a.data.msg)})})},p=function(a){return c(function(c,d){b.post(API_ENDPOINT.url+"/authenticate",a).then(function(a){a.data.success?(g(a.data.token),c(a.data.user)):d(a.data.msg)})})},q=function(){j(),n.showBar=!1,n.menu.sidemenu={},n.menu.moremenu={},setView(n)};e();var r=function(a,b){setView=a,initController=b};return{init:r,login:p,register:o,logout:q,isAuthenticated:function(){return m}}}function AppController(a,b,c,d,e,f,g,h,i,j){function k(){d("left").toggle()}function l(){window.history.back()}function m(a){"l"==a.type?(f.go(a.state),n.selected=a):"f"==a.type}var n=this;n.selectItem=m,n.toggleList=k,n.back=l,n.menuOptions=[],a.ready.then(function(){alert("Cordova is ready")}),c.$watch("ac.menuSelected",function(a,b){if(a)if("l"==a.type)switch(a.name){case"Setting":f.go(a.state)}else if("f"==a.type)switch(a.name){case"Logout":n.logout()}});var o=function(a){c.isLogged=a.showBar,a.showBar&&(n.sidemenu=a.menu.sidemenu,n.menuOptions=new Array,a.menu.moremenu.forEach(function(a){a.name=a.label,"d"==a.type?a.divider=!0:"h"==a.type&&(a.href=a.state)}),n.menuOptions=a.menu.moremenu)},p=function(){n.selected=f.current};g.init(o,p);c.$on(AUTH_EVENTS.notAuthenticated,function(a){g.logout(),f.go("login")});var q;this.openMenu=function(a,b){q=b,a(b)},this.logout=function(a){g.logout(),f.go("login")}}function AuthInterceptor(a,b,c){return{responseError:function(d){return a.$broadcast({401:b.notAuthenticated}[d.status],d),c.reject(d)}}}var startApp=angular.module("powerApp",["ui.router","ngAnimate","ngAria","ngResource","ngSanitize","ngTouch","ngMaterial","LocalStorageModule"]);startApp.constant("AUTH_EVENTS",{notAuthenticated:"auth-not-authenticated"}),startApp.factory("AuthInterceptor",["$rootScope","AUTH_EVENTS","$q",AuthInterceptor]),startApp.service("AuthService",["$rootScope","$http","$q","localStorageService",AuthentificationService]),startApp.controller("appCtrl",["cordova","$rootScope","$scope","$mdSidenav","$mdDialog","$state","AuthService","$timeout","$mdToast","$mdBottomSheet",AppController]),startApp.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$mdDateLocaleProvider","$httpProvider",function(a,b,c,d,e){d.formatDate=function(a){return moment(a).format("DD-MM-YYYY")},c.theme("default").primaryPalette("indigo").accentPalette("purple"),e.interceptors.push("AuthInterceptor")}]).run(["$rootScope","$state","AuthService","AUTH_EVENTS",function(a,b,c,d){a.$on("$stateChangeStart",function(a,d,e,f){c.isAuthenticated()||"login"!==d.name&&(a.preventDefault(),b.go("login"))})}]),angular.module("powerApp").factory("cordova",["$q",function(a){var b=a.defer(),c=!1;return this.ready=b.promise,document.addEventListener("deviceready",function(){c=!0,b.resolve($window.cordova)}),setTimeout(function(){c||$window.cordova&&b.resolve($window.cordova)},3e3),this}]),angular.module("powerApp").run(["$templateCache",function(a){a.put("views/main.html",'<div class="jumbotron"> <h1>\'Allo, \'Allo!</h1> <p class="lead"> <img src="images/yeoman.c582c4d1.png" alt="I\'m Yeoman"><br> Always a pleasure scaffolding your apps. </p> <p><a class="btn btn-lg btn-success" ng-href="#/">Splendid!<span class="glyphicon glyphicon-ok"></span></a></p> </div> <div class="row marketing"> <h4>HTML5 Boilerplate</h4> <p> HTML5 Boilerplate is a professional front-end template for building fast, robust, and adaptable web apps or sites. </p> <h4>Angular</h4> <p> AngularJS is a toolset for building the framework most suited to your application development. </p> <h4>Karma</h4> <p>Spectacular Test Runner for JavaScript.</p> </div>')}]);